{"version":3,"file":"order.spec.js","sourceRoot":"","sources":["../../src/test/order.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import mongoose from \"mongoose\";\nimport request from \"supertest\";\nimport { expect } from \"chai\";\nimport { app, base } from \"../app\";\nimport { Product, Order, Cart } from \"../interfaces\";\nimport { read } from \"fs\";\n\nconst ProductModel = base<Product>(\"product\");\nconst OrderModel = mongoose.model<Order>(\"Order\");\nconst CartModel = mongoose.model<Cart>(\"Cart\");\n\ndescribe(\"/api\", () => {\n  //So Id add authentication and try to signin before all the request and send the\n  //token and be authenticated\n  let cartId = \"0\";\n  beforeEach(async () => {});\n  /* describe(\"post /order/checkout\", () => {\n    it(\"should checkout an order\", async function () {\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.length).not.equal(0);\n      expect(res.body.data.message).equal(\"Order checked out\");\n    });\n  });\n  describe(\"get /order/verify\", () => {\n    it(\"should unsuccessfully find order\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}d`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order not found\");\n    });\n    it(\"should unsuccessfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order verification unsuccessful\");\n    });\n    it(\"should successfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      console.log(ress.body.data.authorization_url);\n      setTimeout(async () => {\n        const res = await request(app).get(\n          `/api/order/verify/${ress.body.data.order.paymentRef}`\n        );\n        const { data } = res.body;\n        expect(res.status).to.equal(200);\n        expect(data.length).not.equal(0);\n        expect(data.message).equal(\"Order verification successful\");\n        await OrderModel.deleteMany();\n      }, 30000);\n    });\n  }); */\n  describe(\"post /cart\", () => {\n    it(\"should not find user\", async function () {\n      await CartModel.deleteMany({});\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb6\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      const { data } = res.body;\n      expect(res.status).to.equal(404);\n      expect(data.message).equal(\"User does not exist\");\n    });\n    it(\"should add items to cart\", async function () {\n      await CartModel.deleteMany({});\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      const { data } = res.body;\n      expect(res.status).to.equal(201);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Products successfully added to cart\");\n    });\n    it(\"should edit amount if product already in cart\", async function () {\n      this.timeout(100000);\n      const addRes = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      const res = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 4 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 13 },\n            {\n              productId: \"recLuFdNG1DVRxZPo\",\n              quantity: 33,\n            },\n          ],\n        });\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Products successfully edited to cart\");\n    });\n  });\n  describe(\"GET /carts\", () => {\n    beforeEach(async function () {\n      this.timeout(50000);\n      await CartModel.deleteMany({});\n      const t = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      // console.log(t);\n    });\n    it(\"should return all cart items\", async function () {\n      this.timeout(100000);\n      const res = await request(app).get(\"/api/carts\");\n      const { data } = res.body;\n      console.log(data.carts);\n      cartId = data.carts[0]._id;\n      expect(res.status).to.equal(200);\n      expect(data.carts.length).equal(1);\n      expect(data.message).equal(\"Retrieved carts successfully\");\n    });\n  });\n  describe(\"GET /cart\", () => {\n    it(\"should return cart by id\", async function () {\n      const res = await request(app).get(`/api/cart/${cartId}`);\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.message).to.equal(\"Cart retrieved successfully\");\n      expect(data.message).to.equal(\"Cart retrieved successfully\");\n    });\n\n    it(\"should say not found\", async function () {\n      const generateId = () => {\n        var timestamp = ((new Date().getTime() / 1000) | 0).toString(16);\n        return (\n          timestamp +\n          \"xxxxxxxxxxxxxxxx\"\n            .replace(/[x]/g, function () {\n              return ((Math.random() * 16) | 0).toString(16);\n            })\n            .toLowerCase()\n        );\n      };\n      const res = await request(app).get(`/api/cart/${generateId()}`);\n      const { data } = res.body;\n      expect(res.status).to.equal(404);\n      expect(data.message).to.equal(\"Cart not found\");\n    });\n\n    it(\"should say not found\", async function () {\n      const res = await request(app).get(`/api/cart/${\"fjhrywhd\"}`);\n      const { data } = res.body;\n      expect(res.status).to.equal(404);\n      expect(data.message).to.equal(\"Invalid userId\");\n    });\n  });\n});\n"]}