{"version":3,"file":"order.spec.js","sourceRoot":"","sources":["../../src/test/order.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import mongoose from \"mongoose\";\nimport request from \"supertest\";\nimport { expect } from \"chai\";\nimport { app, base } from \"../app\";\nimport { Product, Order } from \"../interfaces\";\nimport { read } from \"fs\";\n\nconst ProductModel = base<Product>(\"product\");\nconst OrderModel = mongoose.model<Order>(\"Order\");\n\ndescribe(\"/api\", () => {\n  //So Id add authentication and try to signin before all the request and send the\n  //token and be authenticated\n  beforeEach(async () => {});\n  describe(\"post /order/checkout\", () => {\n    it(\"should checkout an order\", async function () {\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.length).not.equal(0);\n      expect(res.body.data.message).equal(\"Order checked out\");\n    });\n  });\n  describe(\"get /order/verify\", () => {\n    it(\"should unsuccessfully find order\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}d`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order not found\");\n    });\n    it(\"should unsuccessfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order verification unsuccessful\");\n    });\n    it(\"should successfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      console.log(ress.body.data.authorization_url);\n      setTimeout(async () => {\n        const res = await request(app).get(\n          `/api/order/verify/${ress.body.data.order.paymentRef}`\n        );\n        const { data } = res.body;\n        expect(res.status).to.equal(200);\n        expect(data.length).not.equal(0);\n        expect(data.message).equal(\"Order verification successful\");\n        await OrderModel.deleteMany();\n      }, 30000);\n    });\n  });\n});\n"]}