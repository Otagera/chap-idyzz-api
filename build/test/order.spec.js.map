{"version":3,"file":"order.spec.js","sourceRoot":"","sources":["../../src/test/order.spec.ts"],"names":[],"mappings":"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","sourcesContent":["import mongoose from \"mongoose\";\nimport request from \"supertest\";\nimport { expect } from \"chai\";\nimport { app, base } from \"../app\";\nimport { Product, Order, Cart } from \"../interfaces\";\nimport { read } from \"fs\";\n\nconst ProductModel = base<Product>(\"product\");\nconst OrderModel = mongoose.model<Order>(\"Order\");\nconst CartModel = mongoose.model<Cart>(\"Cart\");\n\ndescribe(\"/api\", () => {\n  //So Id add authentication and try to signin before all the request and send the\n  //token and be authenticated\n  beforeEach(async () => {});\n  /* describe(\"post /order/checkout\", () => {\n    it(\"should checkout an order\", async function () {\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      expect(res.status).to.equal(200);\n      expect(res.body.data.length).not.equal(0);\n      expect(res.body.data.message).equal(\"Order checked out\");\n    });\n  });\n  describe(\"get /order/verify\", () => {\n    it(\"should unsuccessfully find order\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}d`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order not found\");\n    });\n    it(\"should unsuccessfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      const res = await request(app).get(\n        `/api/order/verify/${ress.body.data.order.paymentRef}`\n      );\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Order verification unsuccessful\");\n    });\n    it(\"should successfully verify an order payment\", async function () {\n      this.timeout(100000);\n      const ress = await request(app)\n        .post(\"/api/order/checkout\")\n        .send({\n          email: \"otagera@gmail.com\",\n          products: [\n            { PartNumber: \"C000065S048A\", quantity: 2 },\n            { PartNumber: \"N000082L124A\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AA\", quantity: 2 },\n            { PartNumber: \"SG00PL3030AAd\", quantity: 1 },\n          ],\n        });\n      console.log(ress.body.data.authorization_url);\n      setTimeout(async () => {\n        const res = await request(app).get(\n          `/api/order/verify/${ress.body.data.order.paymentRef}`\n        );\n        const { data } = res.body;\n        expect(res.status).to.equal(200);\n        expect(data.length).not.equal(0);\n        expect(data.message).equal(\"Order verification successful\");\n        await OrderModel.deleteMany();\n      }, 30000);\n    });\n  }); */\n  describe(\"post /cart\", () => {\n    it(\"should add items to cart\", async function () {\n      await CartModel.deleteMany({});\n      this.timeout(100000);\n      const res = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      const { data } = res.body;\n      expect(res.status).to.equal(201);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Products successfully added to cart\");\n    });\n    it(\"should edit amount if product already in cart\", async function () {\n      this.timeout(100000);\n      const addRes = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 2 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recIwhNICRFecriHn\", quantity: 5 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 1 },\n          ],\n        });\n      const res = await request(app)\n        .post(\"/api/cart\")\n        .send({\n          userId: \"629551832fbf1068266f5cb7\",\n          products: [\n            { productId: \"recGvUezjm2KUtCdc\", quantity: 4 },\n            { productId: \"recESnRz5hSsHYFAO\", quantity: 12 },\n            { productId: \"recKsJ9EvLq5VOIAR\", quantity: 13 },\n            {\n              productId: \"recLuFdNG1DVRxZPo\",\n              quantity: 33,\n            },\n          ],\n        });\n      const { data } = res.body;\n      expect(res.status).to.equal(200);\n      expect(data.length).not.equal(0);\n      expect(data.message).equal(\"Products successfully edited to cart\");\n    });\n  });\n});\n"]}